- name: 'configure packages'
  hosts: all
  become: true
  tasks:
    - name: 'apt-get update'
      ansible.builtin.apt:
        update_cache: true

    - name: 'apt-get dist-upgrade'
      ansible.builtin.apt:
        upgrade: 'dist'

    - name: 'apt-get upgrade'
      ansible.builtin.apt:
        name: '*'
        state: latest

    - name: 'apt-get autoremove --purge && apt-get clean'
      ansible.builtin.apt:
        autoremove: true
        purge: true
        clean: true

    - name: 'install useful utilities'
      ansible.builtin.apt:
        name:
          - 'git'
          - 'vim'
          - 'tree'
          - 'tmux'
          - 'jq'
          - 'ripgrep'
          - 'htop'
          - 'strace'
          - 'ldnsutils'
          - 'arping'
          - 'tcpdump'
          - 'iperf3'

    - name: 'choose vim as editor'
      community.general.alternatives:
        name: 'editor'
        path: '/usr/bin/vim.basic'

- name: 'configure compute node packages'
  hosts: picluster_compute
  become: true
  tasks:
    - name: 'remove storage utilities'
      ansible.builtin.apt:
        state: absent
        name:
          - 'hdparm'
          - 'smartmontools'

- name: 'configure storage node packages'
  hosts: picluster_storage
  become: true
  tasks:
    - name: 'install storage utilities'
      ansible.builtin.apt:
        name:
          - 'open-iscsi'  # needed by longhorn
          - 'hdparm'
          - 'smartmontools'
