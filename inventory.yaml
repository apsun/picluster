---
k3s_cluster:
  children:
    server:
      hosts:
        raspberrypi5b-yosemite.lan:
        raspberrypi5b-yellowstone.lan:
        raspberrypi5b-zion.lan:
    agent:
      hosts:
        raspberrypi5b-olympic.lan:
        raspberrypi5b-grandcanyon.lan:

  vars:
    ansible_python_interpreter: /usr/bin/python3
    ansible_port: 22
    ansible_user: andrew
    k3s_version: v1.33.0+k3s1
    token: "{{ lookup('ansible.builtin.pipe', 'pass picluster/k3s-token') }}"
    api_endpoint: "{{ hostvars[groups['server'][0]]['ansible_host'] | default(groups['server'][0]) }}"

    # needed because cert is generated with $HOSTNAME, but we connect via $HOSTNAME.lan
    extra_server_args: "--tls-san {{ groups['server'] | map('extract', hostvars, 'inventory_hostname') | join(',') }}"

    # configure http mirror (it will try to use https by default)
    # docker run -d -p 5000:5000 --name registry registry:latest
    registries_config_yaml: |
      mirrors:
        sachiko.lan:
          endpoint:
            - "http://sachiko.lan:5000"
