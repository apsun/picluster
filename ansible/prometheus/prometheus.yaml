- name: 'install kube-prometheus'
  hosts: localhost
  tasks:
    - name: 'add prometheus-community helm repo'
      kubernetes.core.helm_repository:
        name: 'prometheus-community'
        repo_url: 'https://prometheus-community.github.io/helm-charts'

    - name: 'install kube-prometheus'
      kubernetes.core.helm:
        name: 'kube-prometheus'
        chart_ref: 'prometheus-community/kube-prometheus-stack'
        release_namespace: 'monitoring'
        create_namespace: true
        values: "{{ lookup('template', 'values.yaml.j2') | from_yaml }}"
